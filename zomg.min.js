/*! my-project-name 2015-10-24 */
var AcquiredThing=function(){var a=function(){return{update:function(){this.x=this.owner.x,this.y=this.owner.top-20,this.scale.x+=this.spin,this.scale.x<=0&&("front"===this.animations.currentAnim.name?this.animations.play("back"):this.animations.play("front")),(this.scale.x<=0||this.scale.x>=1)&&(this.spin*=-1)}}}();return{create:function(b,c){b.acquiredThing&&b.acquiredThing.destroy&&b.acquiredThing.destroy();var d=b.acquiredThing=game.add.sprite(b.x,b.top-20,c);return d.animations.add("front",[0]),d.animations.add("back",[0]),d.anchor.set(.5,1),d.owner=b,d.spin=-.025,util.assignAllFunctions(d,a),d.update=a.update,zOrder.putInLayer(d,"FLOAT"),d}}}(),Airplane=function(){return{create:function(a){var b=game.add.sprite(a.x-450,config.street.floor,"airplane");return b.sound=game.add.audio("airplane"),b.sound.play(),b.sendToBack(),b.level=a.level,game.camera.followPc=!1,game.camera.unfollow(),b.level.pc.destroy(),game.camera.tween=game.add.tween(b).to({y:game.camera.y-3e3,rotation:Math.PI/6},8e3,Phaser.Easing.Quadratic.In,!0),game.camera.tween=game.add.tween(b).to({x:game.camera.x-6e3},6e3,Phaser.Easing.Linear.In,!0),game.camera.tween=game.add.tween(game.camera).to({y:game.camera.y-3e3},8e3,Phaser.Easing.Quadratic.In,!0),game.camera.tween=game.add.tween(game.camera).to({x:game.camera.x-6500},6e3,Phaser.Easing.Linear.In,!0),zOrder.putInLayer(b,"PLANE"),game.time.events.add(6500,Photo.create,b.level),b}}}(),Airport=function(){var a=function(){return{canBeUsed:function(){return this.level.pc.acquiredThing&&"ticket"===this.level.pc.acquiredThing.key&&this.level.pc.alive},beUsed:function(){this.level.pc.kill(),this.level.pc.acquiredThing&&this.level.pc.acquiredThing.kill&&this.level.pc.acquiredThing.kill(),game.time.events.add(2e3,function(){Airplane.create(this)},this)}}}();return{create:function(b,c){var d=Local.create(config.street.airport,{x:380},c,"airport");return d.anchor.set(.6,1),d.level=c,zOrder.putInLayer(d,"LOCAL"),util.assignAllFunctions(d,a),d}}}(),Atm=function(){var a=function(){var a=function(){return{pop:function(){this.kill()}}}();return{create:function(b){var c=game.add.sprite(b.x,b.header.y-b.header.height-10,"dialogue"),d=b.pc.acquiredThing;return c.anchor.set(.5,1),c.animations.add("1",[0]),c.animations.add("2",[1]),d?c.animations.play("2"):c.animations.play("1"),zOrder.putInLayer(c,"FLOAT"),util.assignAllFunctions(c,a),game.time.events.add(4500,c.pop,c),c}}}(),b=function(){return{done:function(){var a=Card.create(this.pc);return Local.Instance.done.call(this),a},beUsed:function(){game.time.events.add(config.wait.atm/5,a.create,a,this),Local.Instance.beUsed.call(this),game.time.events.add(config.wait.atm,this.done,this)},canBeUsed:function(){return!this.pc.acquiredThing||"stolen-"===this.pc.acquiredThing.key.substring(0,7)}}}();return{create:function(a,c){var d=Local.create(a,{x:300},c,"atm");return d.header=game.add.sprite(a,config.street.wall-d.height,c.selectedBank.bank),d.header.anchor.set(.5,1),zOrder.putInLayer(d.header,"LOCAL"),util.assignAllFunctions(d,b),d}}}(),Background=function(){var a=function(){return{update:function(){this.tilePosition.x=game.camera.x*this.zFactor-this.offset}}}();return{create:function(){var b=game.add.tileSprite(0,game.height,8700,560,"mountains");b.zFactor=config.street.parallax.mountains,zOrder.putInLayer(b,"MOUNTAINS"),b.offset=1400;var c=game.add.tileSprite(0,game.height,8700,560,"town");return c.zFactor=config.street.parallax.town,zOrder.putInLayer(c,"TOWN"),c.offset=100,c.update=b.update=a.update,{town:c}}}}(),BankCarousell=function(){var a=function(){return{up:function(){var a;if(this.selected>0)for(this.selected--,a=0;a<this.bancos.length;a++)game.add.tween(this.bancos[a]).to({y:this.bancos[a].y+this.bancos[a].height+this.offset},300,Phaser.Easing.Exponential.Out,!0)},down:function(){var a;if(this.selected<this.bancos.length-1)for(this.selected++,a=0;a<this.bancos.length;a++)game.add.tween(this.bancos[a]).to({y:this.bancos[a].y-this.bancos[a].height-this.offset},300,Phaser.Easing.Exponential.Out,!0)},getSelectedBank:function(){return this.bancos[this.selected]}}}();return{create:function(){var b,c={bancos:[],offset:20,selected:0};for(util.assignAllFunctions(c,a),b=0;b<bancos.length;b++)c.bancos[b]=game.add.sprite(0,0,bancos[b].nombre),c.bancos[b].x=game.width/2,c.bancos[b].y=game.height/2+b*(c.bancos[b].height+c.offset),c.bancos[b].anchor.set(.5);return c}}}(),bankSelection=function(){return{preload:function(){util.loadBanks(),game.load.image("pick-a-bank","assets/aux/pick-a-bank.png"),game.load.image("arrow","assets/aux/arrow.png"),game.load.spritesheet("button","assets/aux/jugar.png",153,62)},create:function(){this.controls={up:game.input.keyboard.addKey(Phaser.Keyboard.UP),down:game.input.keyboard.addKey(Phaser.Keyboard.DOWN)},this.bankCarousell=BankCarousell.create(),game.stage.backgroundColor="#4ba6c9",this.menu=game.add.sprite(0,0,"pick-a-bank"),this.controls.up.onDown.add(this.bankCarousell.up,this.bankCarousell),this.controls.down.onDown.add(this.bankCarousell.down,this.bankCarousell),this.upArrow=game.add.sprite(game.width/2,130,"arrow"),this.upArrow.anchor.set(.5,1),game.add.tween(this.upArrow.scale).to({y:.7},300,Phaser.Easing.Exponential.Out,!0,0,-1,!0),this.upArrow.inputEnabled=!0,this.upArrow.events.onInputDown.add(this.bankCarousell.up,this.bankCarousell),this.downArrow=game.add.sprite(game.width/2,435,"arrow"),this.downArrow.anchor.set(.5,1),this.downArrow.scale.y=-1,game.add.tween(this.downArrow.scale).to({y:-.7},300,Phaser.Easing.Exponential.Out,!0,0,-1,!0),this.downArrow.inputEnabled=!0,this.downArrow.events.onInputDown.add(this.bankCarousell.down,this.bankCarousell),this.startButton=game.add.sprite(game.width/2,515,"button"),this.startButton.inputEnabled=!0,this.startButton.anchor.set(.5),this.startButton.animations.add("pushed",[1]),this.startButton.animations.add("normal",[0]).play(),this.startButton.level=this,this.startButton.events.onInputOver.add(function(){this.animations.play("pushed")},this.startButton),this.startButton.events.onInputOut.add(function(){this.animations.play("normal")},this.startButton),this.startButton.events.onInputDown.add(function(){var a=this.level.bankCarousell.getSelectedBank();streetLevel.selectedBank={bank:a.key,tarjeta:a.key+"-tarjeta"},game.state.start("street")},this.startButton)}}}(),game=new Phaser.Game(800,560,Phaser.AUTO,"game");game.state.add("bank-selection",bankSelection),game.state.start("bank-selection");var Card=function(){return{create:function(a){var b=AcquiredThing.create(a,a.level.selectedBank.tarjeta);b.animations.add("front",[0]),b.animations.add("back",[1]),b.animations.play("front")}}}(),Character=function(){var a=function(){return{update:function(){game.physics.arcade.collide(this.floor,this)}}}(),b=function(){"dude"===this.key||"thief"===this.key?this.animations.add("walk",[0,1,2,3],9,!0):"standing"===this.key?this.animations.add("walk",[0,0,0,0,1],2,!0):(this.animations.add("walk",[0,2,1,2],10,!0),this.animations.add("stand",[1])),"viajero"===this.key&&(this.animations.add("jump-up",[3]),this.animations.add("jump-down",[4]),this.animations.add("startAction",[5],8,!1),this.animations.add("action",[5]),this.animations.add("stopAction",[5]))};return{create:function(a,c,d,e,f){var g=game.add.sprite(a,c,d),h="BEHIND";return g.level=f,g.floor=e,e===f.collisionMap.bottomFloor&&(h="FRONT"),zOrder.putInLayer(g,h),game.physics.arcade.enable(g),g.anchor.set(.5,1),g.body.setSize(.5*g.width,.9*g.height),b.call(g),g.characterUpdate=Character.Instance.update,g},Instance:a}}(),CollisionMap=function(){var a=function(){var a=function(){return{findFloor:function(a){var b,c,d=this.map.height;for(a=Math.round(a/this.map.tileWidth),c=0;d>c;c++)if(b=this.map.getTile(a,c,this))return(c-1)*this.map.tileHeight;return 200}}}();return{create:function(b,c){var d=b.createLayer(c);return game.physics.arcade.enable(d),b.setCollisionByExclusion([],!0,d),d.resizeWorld(),d.findFloor=a.findFloor,d}}}();return{create:function(){var b=game.add.tilemap("collisionMap",80,14,8560,1120);return b.addTilesetImage("collision-symbols"),b.bottomFloor=a.create(b,"bottom-floor"),b.topFloor=a.create(b,"top-floor"),b.bottomFloor.alpha=b.topFloor.alpha=0,b}}}(),config={street:{wall:897,gravity:2500,floor:700,parallax:{mountains:.9,town:.8},atm:1750,internet:4300,airport:7560,atmWidth:369},traveler:{speed:180,jumpHeight:180,invulnerableTime:1e3},wait:{atm:3e3,internet:1e4},walker:{style:[{key:"girl",speed:220},{key:"girl",speed:250},{key:"dude",speed:230},{key:"dude",speed:220},{key:"standing",speed:0},{key:"standing",speed:0}],thief:{key:"thief",speed:250,stolenSpeed:330},statistics:{spawn:{min:3500,max:6500},thiefSpawn:{min:6500,max:9e3}}},time:100,linkDescargaManual:"http://www.kittenwar.com/"},Counter=function(){var a=function(){var a,b=!1;return{decrease:function(){this.level.pc.alive&&this.level.pc.body||this.stop(),0===a?this.level.timeUp():b||(game.time.events.add(1e3,this.decrease,this),a--,this.text=a)},create:function(){a=config.time+1},stop:function(){b=!0}}}();return{create:function(b){var c={font:"30px Sans",fill:"#000",align:"center"},d=game.add.text(game.width-10,10,"100",c);return d.anchor.set(1,0),d.fixedToCamera=!0,zOrder.putInLayer(d,"TEXT"),d.level=b,util.assignAllFunctions(d,a),d.create(),d.decrease(),d}}}(),Facade=function(){return{create:function(){return facade=game.add.sprite(0,game.height,"facade"),zOrder.putInLayer(facade,"FACADE"),facade}}}(),InteractiveScreen=function(){var a=["La Paz","Cochabamba","Santa Cruz","Tarija","Cobija","Sucre","Trinidad","Buenos Aires","Sao Paulo","Salta","Miami","Madrid"],b=function(){var a=function(){var a=function(){var a=new Phaser.Rectangle(this.x,this.y,this.width,this.height);Phaser.Rectangle.contains(a,game.input.x+game.camera.x,game.input.y+game.camera.y)?this.animations.play("hover"):this.animations.play("normal")},b=function(){this.animations&&this.animations.currentAnim&&"hover"===this.animations.currentAnim.name&&this.onClick&&game.input.mousePointer.isDown&&this.onClick()};return{update:function(){this.scale.x=this.screen.scale.x,this.scale.y=this.screen.scale.y,this.x=this.relative.x*this.scale.x+this.screen.x,this.y=this.relative.y*this.scale.y+this.screen.y,this.alpha=this.screen.alpha,a.call(this),b.call(this)}}}(),b=function(){this.x=this.asset.x+4,this.y=this.asset.y+4,this.scale.x=this.asset.scale.x,this.scale.y=this.asset.scale.y};return{create:function(c,d,e,f,g,h,i){var j=game.add.sprite(f.x+c,f.y+d,e);j.relative={x:c,y:d},j.screen=f,util.assignAllFunctions(j,a),zOrder.putInLayer(j,"ASSETS"),j.alpha=f.alpha;var k={font:"10px Sans",fill:"#000",align:"left"};return j.text=game.add.text(j.x,j.y,g,k),j.text.asset=j,j.text.update=b,zOrder.putInLayer(j.text,"TEXT"),j.onClick=h,j}}}(),c=function(){var a;for(this.combo.text.text=this.key,a=0;a<this.combo.items.length;a++)this.combo.items[a].kill(),this.combo.items[a].onClick=null},d=function(){if(!this.items||!this.items[0].alive){var d,e=[];for(d=0;d<a.length;d++)e[d]=b.create(this.relative.x,this.relative.y+13*(d+1)+7,a[d],this.screen,"",c),e[d].animations.add("hover",[1]),e[d].animations.add("normal",[0]),e[d].combo=this,zOrder.putInLayer(e[d],"TEXT");return this.items=e,e}},e=function(){this.screen.onFinish.call(this.screen.onFinishContext),this.tween=game.add.tween(this.screen).to({x:this.screen.level.pc.x,y:this.screen.level.internet.y,alpha:0},800,Phaser.Easing.Exponential.In,!0),game.add.tween(this.screen.scale).to({x:0,y:0},800,Phaser.Easing.Exponential.In,!0)},f=function(){"Origen"!==this.screen.origin.text.text&&"Destino"!==this.screen.destination.text.text&&(zOrder.putInLayer(this.screen,"TEXT"),this.screen.animations.play("ending"),game.time.events.add(6600,e,this),this.screen.level.destination=this.screen.destination.text.text)},g=function(a){var c=new Date;c=c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear(),console.log(d),a.origin=b.create(15,131,"combo",a,"Origen",d),a.origin.animations.add("hover",[0]),a.origin.animations.add("normal",[0]),a.destination=b.create(120,131,"combo",a,"Destino",d),a.destination.animations.add("hover",[0]),a.destination.animations.add("normal",[0]),a.date=b.create(14,183,"fecha",a,c),a.search=b.create(146,217,"buscar",a,"",f),a.search.animations.add("hover",[0]),a.search.animations.add("normal",[1]),a.search.animations.play("normal")};return{create:function(a,b,c){var d=game.add.sprite(a.pc.x-a.internet.width/2,a.pc.y,"screen"),e=d.width;return d.animations.add("static",[0]),d.animations.add("ending",[1,2,3,4,4,5],.8,!1),d.animations.play("static"),zOrder.putInLayer(d,"FLOAT"),d.alpha=0,d.scale.set(0),d.level=a,d.onFinish=b,d.onFinishContext=c,game.add.tween(d).to({x:a.pc.x+e+100,y:game.camera.y+20,alpha:1},800,Phaser.Easing.Exponential.In,!0),game.add.tween(d.scale).to({x:1,y:1},800,Phaser.Easing.Exponential.In,!0),g(d),d}}}(),Internet=function(){var a=function(){return{done:function(){var a=Ticket.create(this.pc);return game.camera.tween=game.add.tween(game.camera).to({x:this.level.pc.x-game.width/2},750,Phaser.Easing.Quadratic.InOut,!0),game.camera.followPc=!0,Local.Instance.done.call(this),a},beUsed:function(){game.camera.unfollow(),game.camera.followPc=!1,game.camera.tween=game.add.tween(game.camera).to({x:this.door.x-game.width/2+300},750,Phaser.Easing.Quadratic.InOut,!0),this.screen=InteractiveScreen.create(this.level,this.done,this),Local.Instance.beUsed.call(this)},canBeUsed:function(){return this.level.pc.hasCard()}}}();return{create:function(b,c){var d=Local.create(config.street.internet,{x:191},c,"internet");return d.level=c,util.assignAllFunctions(d,a),d}}}(),Keyboard=function(){var a=function(){return{isOn:function(a){var b=0;for(b=0;b<a.length;b++)if(this[a[b]].isDown)return!0;return!1}}}();return{create:function(){var b=game.input.keyboard.createCursorKeys();return b.space=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),b.w=game.input.keyboard.addKey(Phaser.Keyboard.W),b.a=game.input.keyboard.addKey(Phaser.Keyboard.A),b.s=game.input.keyboard.addKey(Phaser.Keyboard.S),b.d=game.input.keyboard.addKey(Phaser.Keyboard.D),b.ctrl=game.input.keyboard.addKey(Phaser.Keyboard.CONTROL),b.enter=game.input.keyboard.addKey(Phaser.Keyboard.ENTER),b.actions={up:["w","up"],action:["space","ctrl","enter"],left:["left","a"],right:["right","d"]},b.isOn=a.isOn,b}}}(),Local=function(){var a=function(){return{done:function(){this.animations.play("off"),this.pc.stopUsingIt()},beUsed:function(){this.animations.play("on")},update:function(){this.pc.canUseIt(this)&&this.canBeUsed()&&this.pc.cursor.isOn(this.pc.cursor.actions.action)&&this.pc.useIt(this)},canBeUsed:function(){return!0}}}();return{create:function(b,c,d,e){var f=game.add.sprite(b,config.street.wall,e);return c.x+=b-f.width/2,f.door=c,f.animations.add("on",[0]),f.animations.add("off",[0]),f.animations.play("off"),f.anchor.set(.5,1),f.pc=d.pc,zOrder.putInLayer(f,"LOCAL"),util.assignAllFunctions(f,a),this.collection.push(f),f},collection:[],Instance:a}}(),Photo=function(){var a=function(){this.sound.play(),this.alpha=1,this.flash.alpha=1,game.add.tween(this.flash).to({alpha:0},200,Phaser.Easing.Exponential.In,!0)};return{create:function(){var b,c=[],d=game.add.sprite(0,0,"flash"),e=game.add.button(game.width/2,game.height-20,"descarga-manual",function(){window.open(config.linkDescargaManual,"_blank")},e,0,1,0,0),f=game.add.sprite(10,10,"att"),g=game.add.sprite(game.width-10,10,"ministerio-de-gobierno");for(g.anchor.set(1,0),zOrder.putInLayer(f,"FLOAT"),zOrder.putInLayer(g,"FLOAT"),f.alpha=g.alpha=e.alpha=0,e.anchor.set(.5,1),f.fixedToCamera=g.fixedToCamera=e.fixedToCamera=!0,zOrder.putInLayer(e,"FLOAT"),game.time.events.add(2400,function(){this.button.alpha=this.logoMinGob.alpha=this.logoAtt.alpha=1},{button:e,logoAtt:f,logoMinGob:g}),c[0]=game.add.sprite(game.width/2,game.height/2-100,this.destination+"-pictures"),c[1]=game.add.sprite(game.width/2+c[0].width/2.1,game.height/2+c[0].height/2-100,this.destination+"-pictures"),c[1].rotation+=.5,c[2]=game.add.sprite(game.width/2-c[0].width/2.2,game.height/2+c[0].height/2-100,this.destination+"-pictures"),c[2].rotation-=.3,d.fixedToCamera=!0,zOrder.putInLayer(d,"ASSETS"),b=0;b<c.length;b++)zOrder.putInLayer(c[b],"FLOAT"),c[b].alpha=0,game.time.events.add(800*b,a,c[b]),c[b].fixedToCamera=!0,c[b].flash=d,c[b].anchor.set(.5),c[b].animations.add("be",[b]),c[b].animations.play("be"),c[b].sound=game.add.audio("photo");zOrder.putInLayer(c[1],"FLOAT"),zOrder.putInLayer(c[2],"FLOAT")}}}(),Screen=function(){var a=function(){return{update:function(){this.tween&&!this.tween.isRunning,this.tween||this.animations.currentAnim.isPlaying||(this.onFinish.call(this.onFinishContext),this.tween=game.add.tween(this).to({x:this.level.pc.x,y:this.level.internet.y,alpha:0},800,Phaser.Easing.Exponential.In,!0),game.add.tween(this.scale).to({x:0,y:0},800,Phaser.Easing.Exponential.In,!0))}}}(),b=function(){return this.spriteModel||(this.spriteModel=game.add.sprite(-100,-100,"screen"),this.spriteModel.kill()),this.spriteModel};return{create:function(b,c,d){var e=game.add.sprite(b.internet.x,b.internet.y,"screen");return zOrder.putInLayer(e,"FLOAT"),e.alpha=0,e.scale.set(0),e.animations.add("register",[0,1,2,3,4,5],debug?4:1,!1),e.animations.play("register"),e.anchor.set(1,0),e.onFinish=c,e.onFinishContext=d,e.level=b,util.assignAllFunctions(e,a),game.add.tween(e).to({x:b.pc.x+Screen.getWidth()+Screen.getWidth()/2+100,y:game.camera.y+20,alpha:1},800,Phaser.Easing.Exponential.In,!0),game.add.tween(e.scale).to({x:1,y:1},800,Phaser.Easing.Exponential.In,!0),e},getWidth:function(){return b.call(this).width},getHeight:function(){return b.call(this).height}}}(),debug=!1,streetLevel=function(){var a=function(){util.loadBanks(),game.load.audio("jump","assets/sfx/jump.mp3"),game.load.audio("photo","assets/sfx/photo.mp3"),game.load.audio("airplane","assets/sfx/airplane.mp3"),game.load.audio("suspense","assets/sfx/suspense.mp3"),game.load.image("flash","assets/aux/flash.png"),game.load.image("atm","assets/retail/atm.png"),game.load.spritesheet("internet","assets/retail/internet.png",284,284),game.load.spritesheet("viajero","assets/retail/viajero.png",80,120),game.load.spritesheet("card","assets/retail/tarjeta.png",128,83),game.load.spritesheet("ticket","assets/retail/porta-boletos.png",67,162),game.load.spritesheet("airport","assets/retail/aeropuerto.png",789,322),game.load.spritesheet("airplane","assets/retail/avion.png",453,131),game.load.spritesheet("enter","assets/aux/enter.png",45,61),game.load.spritesheet("girl","assets/retail/peaton1.png",80,118),game.load.spritesheet("dude","assets/retail/peaton2.png",78,118),game.load.spritesheet("standing","assets/retail/peaton3.png",78,118),game.load.spritesheet("thief","assets/retail/ladron.png",78,118),game.load.spritesheet("dialogue","assets/aux/dialogue.png",332,96),game.load.spritesheet("descarga-manual","assets/retail/btn-descarga-manual.png",170,37),game.load.image("ministerio-de-gobierno","config/logo-del-ministerio-de-gobierno.png"),game.load.image("att","config/logo-de-att.png"),game.load.spritesheet("buscar","assets/retail/pantalla/buscar.png",66,20),game.load.spritesheet("La Paz","assets/retail/pantalla/la-paz.png",89,13),game.load.spritesheet("Cochabamba","assets/retail/pantalla/cochabamba.png",89,13),game.load.spritesheet("Santa Cruz","assets/retail/pantalla/santa-cruz.png",89,13),game.load.spritesheet("Tarija","assets/retail/pantalla/tarija.png",89,13),game.load.spritesheet("Cobija","assets/retail/pantalla/cobija.png",89,13),game.load.spritesheet("Sucre","assets/retail/pantalla/sucre.png",89,13),game.load.spritesheet("Trinidad","assets/retail/pantalla/trinidad.png",89,13),game.load.spritesheet("Buenos Aires","assets/retail/pantalla/buenos-aires.png",89,13),game.load.spritesheet("Sao Paulo","assets/retail/pantalla/sao-paulo.png",89,13),game.load.spritesheet("Salta","assets/retail/pantalla/salta.png",89,13),game.load.spritesheet("Miami","assets/retail/pantalla/miami.png",89,13),game.load.spritesheet("Madrid","assets/retail/pantalla/madrid.png",89,13),game.load.spritesheet("La Paz-pictures","config/fotos-la-paz.png",300,254),game.load.spritesheet("Cochabamba-pictures","config/fotos-cochabamba.png",300,254),game.load.spritesheet("Santa Cruz-pictures","config/fotos-santa-cruz.png",300,254),game.load.spritesheet("Tarija-pictures","config/fotos-tarija.png",300,254),game.load.spritesheet("Cobija-pictures","config/fotos-cobija.png",300,254),game.load.spritesheet("Sucre-pictures","config/fotos-sucre.png",300,254),game.load.spritesheet("Trinidad-pictures","config/fotos-trinidad.png",300,254),game.load.spritesheet("Buenos Aires-pictures","config/fotos-buenos-aires.png",300,254),game.load.spritesheet("Sao Paulo-pictures","config/fotos-sao-paulo.png",300,254),game.load.spritesheet("Salta-pictures","config/fotos-salta.png",300,254),game.load.spritesheet("Miami-pictures","config/fotos-miami.png",300,254),game.load.spritesheet("Madrid-pictures","config/fotos-madrid.png",300,254),game.load.spritesheet("screen","assets/retail/pantalla/screen.png",257,257),game.load.image("combo","assets/retail/pantalla/combobox.png"),game.load.image("combito","assets/retail/pantalla/combito.png"),game.load.image("fecha","assets/retail/pantalla/fecha.png"),game.load.image("town","assets/retail/ciudad-de-fondo.png"),game.load.image("mountains","assets/retail/cerros.png"),game.load.image("facade","assets/retail/facade.png"),game.load.tilemap("collisionMap","assets/aux/collision-map.json",null,Phaser.Tilemap.TILED_JSON),game.load.image("collision-symbols","assets/aux/collision-symbols.png"),game.load.start()},b=function(){this.parallaxBacskground=Background.create(),game.physics.startSystem(Phaser.Physics.ARCADE),game.physics.arcade.gravity.set(0,config.street.gravity),this.collisionMap=CollisionMap.create(),this.facade=Facade.create(),this.depthZSorting=game.add.group(),this.pc=Traveler.create(this),this.walkerSpawner=[Walker.Spawner.create(this,this.collisionMap.topFloor),Walker.Spawner.create(this,this.collisionMap.bottomFloor)],this.walkerSpawner[0].spawn(),this.walkerSpawner[1].spawn(),this.thiefSpawner=Thief.Spawner.create(this),this.thiefSpawner.spawn(),this.atm=Atm.create(config.street.atm,this),this.internet=Internet.create(3e3,this),this.airport=Airport.create(4e3,this),debug&&(this.pc.x=config.street.internet,this.pc.acquiredThing={key:"card"}),game.world.resize(8500,560),counter=Counter.create(this),this.loadingBar.visible=!1,this.bgLoadingBar.visible=!1};return{preload:function(){game.load.image("loading","assets/aux/loading.png"),game.load.image("bg-loading","assets/aux/background-loading.png")},create:function(){this.bgLoadingBar=game.add.sprite(game.width/2,game.height/1.6,"bg-loading"),this.loadingBar=game.add.sprite(game.width/2,game.height/1.6,"loading"),this.loadingBar.anchor.set(.5),this.bgLoadingBar.anchor.set(.5),game.load.setPreloadSprite(this.loadingBar),game.stage.backgroundColor="#1a638e",a(),game.load.onLoadComplete.add(b,this)},update:function(){zOrder.sort()},render:function(){},timeUp:function(){var a=2e3;game.camera.followPc=!1,game.camera.unfollow(),game.add.tween(game.camera).to({x:this.airport.door.x-game.width/2-50},a,Phaser.Easing.Quadratic.InOut,!0),game.time.events.add(a/2,this.airport.beUsed,this.airport)}}}();game.state.add("street",streetLevel);var Thief=function(){var a=function(){return{collidePc:function(){this.stolen||this.level.pc.using||this.steal()},steal:function(){this.opponent.hasCard()&&(this.stealSound.play(),this.body.velocity.x=this.scale.x*this.stolenSpeed,this.stolen=this.opponent.acquiredThing,this.opponent.acquiredThing={key:"stolen-"+this.stolen.key},this.stolen&&(this.stolen.owner=this))},die:function(){this.stolen&&this.stolen.destroy(),Walker.Instance.die.call(this)}}}(),b=function(){var a=function(){return{spawn:function(){return game.time.events.add(util.getRnd(config.walker.statistics.thiefSpawn),this.spawn,this),this.level.pc.hasCard()?Thief.create(Walker.spawningSide.RIGHT,this.level):void 0}}}();return{create:function(b){var c={level:b};return util.assignAllFunctions(c,a),c}}}();return{create:function(b,c){var d=Walker.create(b,config.walker.thief,c.pc,c.pc.floor,c);return d.stolenSpeed=config.walker.thief.stolenSpeed,d.stealSound=game.add.audio("suspense"),util.assignAllFunctions(d,a),d},Spawner:b}}(),Ticket=function(){return{create:function(a){var b=AcquiredThing.create(a,"ticket");b.animations.add("front",[0]),b.animations.add("back",[1]),b.animations.play("front")}}}(),Traveler=function(){var a=function(){var a=function(){Math.abs(this.x-this.using.door.x)>5||Math.abs(this.y-this.using.y)>5?game.physics.arcade.moveToXY(this,this.using.door.x,config.street.wall+1,100):this.body.velocity.y=this.body.velocity.x=0},b=function(){this.body.velocity.x=0,this.using?a.call(this):(this.cursor.isOn(this.cursor.actions.left)&&(this.body.velocity.x=-this.speed,this.scale.x=-1),this.cursor.isOn(this.cursor.actions.right)&&(this.body.velocity.x=this.speed,this.scale.x=1))},c=function(){this.using?"startAction"!==this.animations.currentAnim.name||this.animations.currentAnim.isPlaying||this.animations.play("action"):this.body.velocity.y>0?this.animations.play("jump-down"):this.body.velocity.y<0?this.animations.play("jump-up"):0!==this.body.velocity.x?this.animations.play("walk"):this.animations.play("stand")},d=function(){!game.camera.followPc||game.camera.tween&&game.camera.tween.isRunning||game.camera.follow(this,Phaser.Camera.FOLLOW_PLATFORMER)};return{update:function(){this.characterUpdate(),b.call(this),c.call(this),d.call(this),this.canUseALocal()?this.tutorial.alpha=1:this.tutorial.alpha=0},isInvulnerable:function(){return this.blinkTween&&this.blinkTween.isRunning},takeDamage:function(){this.isInvulnerable()||(this.alpha=0,this.blinkTween=game.add.tween(this).to({alpha:1},config.traveler.invulnerableTime/5,Phaser.Easing.Bounce.In,!0,0,4),console.log("ouch!"))},jump:function(){this.body.blocked.down&&(this.body.velocity.y=-this.jumpSpeed,this.canUseALocal()||this.jumpSound.play())},useIt:function(a){this.using=a,a.beUsed(this),this.body&&(this.body.allowGravity=!1,this.animations.play("startAction"))},stopUsingIt:function(){this.using=null,this.body.allowGravity=!0,this.animations.play("stopAction")},canUseIt:function(a){var b=this.y>=a.y&&!this.using&&Math.abs(a.door.x-this.x)<125;return b},canUseALocal:function(){var a,b;for(a=0;a<Local.collection.length;a++)if(b=Local.collection[a],this.canUseIt(b)&&b.canBeUsed())return!0},hasCard:function(){var a;return this.acquiredThing?(a=this.acquiredThing.key,"tarjeta"===a.substring(a.length-7,a.length)&&"stolen"!==a.substring(0,6)):!1}}}();return{create:function(b){var c=Character.create(300,config.street.wall,"viajero",b.collisionMap.bottomFloor,b);c.jumpSound=game.add.audio("jump"),c.body.collideWorldBounds=!0,c.speed=config.traveler.speed,c.jumpSpeed=Math.sqrt(2*config.traveler.jumpHeight*config.street.gravity),util.assignAllFunctions(c,a),c.cursor=Keyboard.create(),game.camera.followPc=!0;for(var d=0;d<c.cursor.actions.up.length;d++)c.cursor[c.cursor.actions.up[d]].onDown.add(a.jump,c);var e=c.tutorial=game.add.sprite(0,0,"enter");return e.animations.add("press",[0,1],2,!0),e.animations.play("press"),e.pc=c,e.anchor.set(.5,0),zOrder.putInLayer(e,"FLOAT"),e.update=function(){this.x=this.pc.x,this.y=this.pc.y},c}}}(),util=function(){return{objToArray:function(a){var b,c=[];for(b in a)c.push(a[b]);return c},getRnd:function(a){return game.rnd.integerInRange(a.min,a.max)},assignAllFunctions:function(a,b){var c,d;for(c in b)d=b[c],"function"==typeof d&&(a[c]=d);return a},loadBanks:function(){var a;for(a=0;a<bancos.length;a++)game.load.image(bancos[a].nombre,"config/bancos/"+bancos[a].imagenBanco),game.load.spritesheet(bancos[a].nombre+"-tarjeta","config/bancos/"+bancos[a].imagenTarjeta,128,83)}}}(),Walker=function(){var a=[],b=function(){return{update:function(){this.characterUpdate(),this.collidesWithPc&&game.physics.arcade.overlap(this.opponent,this,this.collidePc,null,this),this.isOutOfSight()&&this.die()},standUpdate:function(){this.characterUpdate(),this.collidesWithPc&&game.physics.arcade.collide(this.opponent,this),this.isOutOfSight()&&this.die()},die:function(){this.destroy(),Walker.dead.push(this)},isOutOfSight:function(){return this.x<game.camera.x-100||this.x>game.camera.x+game.width+100},collidePc:function(a,b){this.hasTurnedBack||(this.turnBack(),this.hasTurnedBack=!0)},turnBack:function(){this.body.velocity.x*=-1,this.scale.x*=-1}}}(),c=function(){var a=function(){return{spawn:function(){return game.time.events.add(util.getRnd(config.walker.statistics.spawn),this.spawn,this),Walker.create(game.rnd.pick(util.objToArray(Walker.spawningSide)),game.rnd.pick(config.walker.style),this.lvl.pc,this.floor||this.lvl.collisionMap[game.rnd.pick(["bottomFloor","topFloor"])],this.lvl)}}}();return{create:function(b,c){return spawner={spawn:a.spawn,lvl:b,floor:c}}}}();return{create:function(a,c,d,e,f){var g=Character.create(game.camera.x,e.findFloor(game.camera.x),c.key,e,f);return util.assignAllFunctions(g,b),g.body.velocity.x=c.speed,g.opponent=d,g.collidesWithPc=d.floor===g.floor,a===Walker.spawningSide.RIGHT&&(g.x+=game.camera.width,g.turnBack()),g.animations.play("walk"),"standing"===g.key&&(g.update=b.standUpdate,g.body.immovable=!0),g},spawningSide:{RIGHT:0,LEFT:1},Instance:b,Spawner:c,dead:a}}(),zOrder=function(){var a,b=[],c=12;for(a=0;c>a;a++)b.push([]);return{order:b,HIDDEN:0,SKY:1,MOUNTAINS:2,TOWN:3,PLANE:4,FACADE:5,LOCAL:6,BEHIND:7,FRONT:8,FLOAT:9,ASSETS:10,TEXT:11,sort:function(){var a,c;for(a=0;a<b.length;a++)for(c=0;c<b[a].length;c++)b[a][c].bringToTop()},putInLayer:function(a,b){this.order[this[b]].push(a)}}}();